<div class="chooseSearch">
  <div>
    <button (click)="searchDropdownToggle = !searchDropdownToggle">
      Search For: {{ searchType
      }}<span class="material-symbols-outlined"> arrow_drop_down </span>
    </button>
    <p
      *ngIf="searchDropdownToggle"
      (click)="
        searchDropdownToggle = !searchDropdownToggle; searchType = 'Books'
      "
    >
      Books
    </p>
    <p
      *ngIf="searchDropdownToggle"
      (click)="
        searchDropdownToggle = !searchDropdownToggle; searchType = 'Users'
      "
    >
      Users
    </p>
  </div>
  <!-- search bar to find users if name contains the text that is input -->
  <div *ngIf="searchType == 'Users'" class="userSearchBar">
    <form #Search="ngForm" (ngSubmit)="SearchUsers(Search)">
      <input
        class="usernameInput"
        type="text"
        name="username"
        placeholder="Search for users"
        ngModel
      />
      <button>Search</button>
    </form>
  </div>
  <!-- searchbar, allows search w/ any combination of title, author, and subject -->
  <div *ngIf="searchType == 'Books'" class="searchBar">
    <form #Submit="ngForm" (ngSubmit)="SearchBooks(Submit)">
      <input type="text" name="title" placeholder="Search by title" ngModel />
      <input type="text" name="author" placeholder="Search by author" ngModel />
      <input
        type="text"
        name="subject"
        placeholder="Search by subject"
        ngModel
      />
      <button>Search</button>
    </form>
  </div>
</div>
<!-- </div> -->

<!-- display users from search -->
<div *ngFor="let u of searchedUsers">
  <!-- clickable image that routes to displayed user's profile -->
  <a routerLink="/UserProfile/{{ u.sqlId }}"
    ><img class="zoom" src="{{ u.photoUrl }}"
  /></a>
  <!-- username also routes to displayed user's profile -->
  <a routerLink="/UserProfile/{{ u.sqlId }}">
    <p>{{ u.name }}</p>
  </a>
</div>

<!-- container for display books from search -->
<h1 *ngIf="books.items != undefined">Search Results:</h1>
<div *ngIf="books.items != undefined" class="searchResultsContainer">
  <div class="searchBook" *ngFor="let b of books.items">
    <div class="searchResult">
      <!-- book cover thumbnail image routes to single book info page -->
      <div class="searchImageAndButtons">
        <div class="searchImage">
          <a routerLink="/Book/{{ getIsbn(b) }}"
            ><img class="zoom" src="{{ getThumbnail(b) }}"
          /></a>
        </div>
        <div class="searchButtons">
          <!-- button that adds book to favorites -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInFavoriteList(b)"
            (click)="addFavorite(b); getRecommendations(this.user.id)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              hotel_class
            </span>
            <br />
            <p class="buttonText">Favorite</p>
          </button>
          <!-- if user is not logged in they will get a message instead of buttons -->
          <p *ngIf="!loggedIn">Log in to create personalized lists</p>
          <!-- button that adds book to wishlist -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInWishList(b)"
            (click)="addToWishList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              menu_book
            </span>
            <br />
            <p class="buttonText">Wish List</p>
          </button>
          <!-- button that adds book to readlist -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInReadList(b)"
            (click)="addToReadList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              bookmark_added
            </span>
            <br />
            <p class="buttonText">Already Read</p>
          </button>
          <!-- button that adds book to denied list -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInDeniedList(b)"
            (click)="addToDeniedList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              dangerous
            </span>
            <br />
            <p class="buttonText">Uninterested</p>
          </button>
        </div>
      </div>
      <!-- holds information from book to display -->
      <div class="searchInfo">
        <!-- book title routes to single book info page -->
        <h6>
          <a routerLink="/Book/{{ getIsbn(b) }}">{{
            b.volumeInfo.title.length > 30
              ? (b.volumeInfo.title | slice: 0:30) + "..."
              : b.volumeInfo.title
          }}</a>
        </h6>
        <p>Author(s): {{ b.volumeInfo.authors }}</p>
        <p>Categories: {{ b.volumeInfo.categories }}</p>
      </div>
      <!-- holds buttons for books from search -->
    </div>
  </div>
</div>

<!-- displays recommendations only if user is logged in -->
<h1 *ngIf="showRecommended()">Recommendations:</h1>
<!-- container for recommended image, info, and buttons -->
<div *ngIf="showRecommended()" class="recommendedContainer">
  <!-- recommendation image, clicking brings user to book info page -->
  <button
    *ngIf="recommendationCount != 0"
    class="nextRecommendButton"
    (click)="previousRecommendation()"
  >
    <span class="material-symbols-outlined"> arrow_back_ios </span>
  </button>
  <div class="recommendedThumbnail">
    <a routerLink="/Book/{{ getIsbn(recommendations[recommendationCount]) }}"
      ><img
        class="recommendedImage"
        src="{{ getThumbnail(recommendations[recommendationCount]) }}"
    /></a>
  </div>
  <!-- displays all info on recommended book in container -->
  <div class="recommendedInfo">
    <h2>
      <a
        routerLink="/Book/{{ getIsbn(recommendations[recommendationCount]) }}"
        >{{ recommendations[recommendationCount].volumeInfo.title }}</a
      >
    </h2>
    <h3>
      Author(s): {{ recommendations[recommendationCount].volumeInfo.authors }}
    </h3>
    <h3>
      Categories:
      {{ recommendations[recommendationCount].volumeInfo.categories }}
    </h3>
    <h3
      *ngIf="
        recommendations[recommendationCount].volumeInfo.ratingsCount !=
        undefined
      "
    >
      Average Rating:
      {{ recommendations[recommendationCount].volumeInfo.averageRating }} / 5
    </h3>
    <!-- switches text if book does not have ratings -->
    <h3
      *ngIf="
        recommendations[recommendationCount].volumeInfo.ratingsCount ==
        undefined
      "
    >
      Ratings not available
    </h3>
    <button
      (click)="
        toggleUserRecommendation();
        getNotRecommendedTo(userFollowing, recommendations[recommendationCount])
      "
    >
      recommend
    </button>
    <div *ngIf="toggleUserRecommendations" class="reccomendToUsers">
      <div *ngFor="let u of notRecommendedTo">
        <img
          src="{{ u.photoUrl }}"
          (click)="sendReccomendation(recommendations[recommendationCount], u)"
        />
        <h6
          (click)="sendReccomendation(recommendations[recommendationCount], u)"
        >
          {{ u.name }}
        </h6>
      </div>
    </div>
  </div>
  <!-- holds list buttons in recommended container -->
  <div class="recommendedButtons">
    <!-- displays favorite button only if book is not favorited, if also in read list goes to next recommendation -->
    <button
      class="iconButton"
      *ngIf="
        loggedIn && !CheckIfInFavoriteList(recommendations[recommendationCount])
      "
      (click)="
        addFavorite(recommendations[recommendationCount]);
        nextFromFavorite(recommendations[recommendationCount])
      "
    >
      <span id="icon" class="material-symbols-outlined"> hotel_class </span>
      <br />
      <p class="buttonText">Favorite</p>
      <!-- displays wishlist button only if not in wishlist, goes to next recommendation -->
    </button>
    <br />
    <button
      class="iconButton"
      *ngIf="
        loggedIn && !CheckIfInWishList(recommendations[recommendationCount])
      "
      (click)="
        addToWishList(recommendations[recommendationCount]);
        nextRecommendation()
      "
    >
      <span id="icon" class="material-symbols-outlined"> menu_book </span>
      <br />
      <p class="buttonText">Wish List</p>
    </button>
    <br />
    <!-- displays readlist button only if not in readlist, goes to next recommendation if also favorited -->
    <button
      class="iconButton"
      *ngIf="
        loggedIn && !CheckIfInReadList(recommendations[recommendationCount])
      "
      (click)="
        addToReadList(recommendations[recommendationCount]);
        nextFromReadList(recommendations[recommendationCount])
      "
    >
      <span id="icon" class="material-symbols-outlined"> bookmark_added </span>
      <br />
      <p class="buttonText">Already Read</p>
    </button>
    <br />
    <!-- displays denied list button, goes to next reccomendation -->
    <button
      class="iconButton"
      *ngIf="
        loggedIn && !CheckIfInDeniedList(recommendations[recommendationCount])
      "
      (click)="
        addToDeniedList(recommendations[recommendationCount]);
        nextRecommendation()
      "
    >
      <span id="icon" class="material-symbols-outlined"> dangerous </span>
      <br />
      <p class="buttonText">Uninterested</p>
    </button>
  </div>
  <br />
  <!-- go to next recommendation without clicking list buttons -->
  <button
    *ngIf="recommendationCount != recommendations.length - 1"
    class="nextRecommendButton"
    (click)="nextRecommendation()"
  >
    <span class="material-symbols-outlined"> arrow_forward_ios </span>
  </button>
</div>

<h1 *ngIf="topAuthorBooks.items != undefined">{{ topAuthors[0] }}</h1>
<div *ngIf="topAuthorBooks.items != undefined" class="searchResultsContainer">
  <div class="searchBook" *ngFor="let b of topAuthorBooks.items">
    <div class="searchResult">
      <!-- book cover thumbnail image routes to single book info page -->
      <div class="searchImageAndButtons">
        <div class="searchImage">
          <a routerLink="/Book/{{ getIsbn(b) }}"
            ><img class="zoom" src="{{ getThumbnail(b) }}"
          /></a>
        </div>
        <div class="searchButtons">
          <!-- button that adds book to favorites -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInFavoriteList(b)"
            (click)="addFavorite(b); getRecommendations(this.user.id)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              hotel_class
            </span>
            <br />
            <p class="buttonText">Favorite</p>
          </button>
          <!-- if user is not logged in they will get a message instead of buttons -->
          <p *ngIf="!loggedIn">Log in to create personalized lists</p>
          <!-- button that adds book to wishlist -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInWishList(b)"
            (click)="addToWishList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              menu_book
            </span>
            <br />
            <p class="buttonText">Wish List</p>
          </button>
          <!-- button that adds book to readlist -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInReadList(b)"
            (click)="addToReadList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              bookmark_added
            </span>
            <br />
            <p class="buttonText">Already Read</p>
          </button>
          <!-- button that adds book to denied list -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInDeniedList(b)"
            (click)="addToDeniedList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              dangerous
            </span>
            <br />
            <p class="buttonText">Uninterested</p>
          </button>
        </div>
      </div>
      <!-- holds information from book to display -->
      <div class="searchInfo">
        <!-- book title routes to single book info page -->
        <h6>
          <a routerLink="/Book/{{ getIsbn(b) }}">{{
            b.volumeInfo.title.length > 30
              ? (b.volumeInfo.title | slice: 0:30) + "..."
              : b.volumeInfo.title
          }}</a>
        </h6>
        <p>Author(s): {{ b.volumeInfo.authors }}</p>
        <p>Categories: {{ b.volumeInfo.categories }}</p>
      </div>
      <!-- holds buttons for books from search -->
    </div>
  </div>
</div>

<h1 *ngIf="topAuthorBooks2.items != undefined">{{ topAuthors[1] }}</h1>
<div *ngIf="topAuthorBooks2.items != undefined" class="searchResultsContainer">
  <div class="searchBook" *ngFor="let b of topAuthorBooks2.items">
    <div class="searchResult">
      <!-- book cover thumbnail image routes to single book info page -->
      <div class="searchImageAndButtons">
        <div class="searchImage">
          <a routerLink="/Book/{{ getIsbn(b) }}"
            ><img class="zoom" src="{{ getThumbnail(b) }}"
          /></a>
        </div>
        <div class="searchButtons">
          <!-- button that adds book to favorites -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInFavoriteList(b)"
            (click)="addFavorite(b); getRecommendations(this.user.id)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              hotel_class
            </span>
            <br />
            <p class="buttonText">Favorite</p>
          </button>
          <!-- if user is not logged in they will get a message instead of buttons -->
          <p *ngIf="!loggedIn">Log in to create personalized lists</p>
          <!-- button that adds book to wishlist -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInWishList(b)"
            (click)="addToWishList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              menu_book
            </span>
            <br />
            <p class="buttonText">Wish List</p>
          </button>
          <!-- button that adds book to readlist -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInReadList(b)"
            (click)="addToReadList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              bookmark_added
            </span>
            <br />
            <p class="buttonText">Already Read</p>
          </button>
          <!-- button that adds book to denied list -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInDeniedList(b)"
            (click)="addToDeniedList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              dangerous
            </span>
            <br />
            <p class="buttonText">Uninterested</p>
          </button>
        </div>
      </div>
      <!-- holds information from book to display -->
      <div class="searchInfo">
        <!-- book title routes to single book info page -->
        <h6>
          <a routerLink="/Book/{{ getIsbn(b) }}">{{
            b.volumeInfo.title.length > 30
              ? (b.volumeInfo.title | slice: 0:30) + "..."
              : b.volumeInfo.title
          }}</a>
        </h6>
        <p>Author(s): {{ b.volumeInfo.authors }}</p>
        <p>Categories: {{ b.volumeInfo.categories }}</p>
      </div>
      <!-- holds buttons for books from search -->
    </div>
  </div>
</div>

<h1 *ngIf="topAuthorBooks3.items != undefined">{{ topAuthors[2] }}</h1>
<div *ngIf="topAuthorBooks3.items != undefined" class="searchResultsContainer">
  <div class="searchBook" *ngFor="let b of topAuthorBooks3.items">
    <div class="searchResult">
      <!-- book cover thumbnail image routes to single book info page -->
      <div class="searchImageAndButtons">
        <div class="searchImage">
          <a routerLink="/Book/{{ getIsbn(b) }}"
            ><img class="zoom" src="{{ getThumbnail(b) }}"
          /></a>
        </div>
        <div class="searchButtons">
          <!-- button that adds book to favorites -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInFavoriteList(b)"
            (click)="addFavorite(b); getRecommendations(this.user.id)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              hotel_class
            </span>
            <br />
            <p class="buttonText">Favorite</p>
          </button>
          <!-- if user is not logged in they will get a message instead of buttons -->
          <p *ngIf="!loggedIn">Log in to create personalized lists</p>
          <!-- button that adds book to wishlist -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInWishList(b)"
            (click)="addToWishList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              menu_book
            </span>
            <br />
            <p class="buttonText">Wish List</p>
          </button>
          <!-- button that adds book to readlist -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInReadList(b)"
            (click)="addToReadList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              bookmark_added
            </span>
            <br />
            <p class="buttonText">Already Read</p>
          </button>
          <!-- button that adds book to denied list -->
          <button
            class="iconButton"
            *ngIf="loggedIn && !CheckIfInDeniedList(b)"
            (click)="addToDeniedList(b)"
          >
            <span id="searchIcon" class="material-symbols-outlined">
              dangerous
            </span>
            <br />
            <p class="buttonText">Uninterested</p>
          </button>
        </div>
      </div>
      <!-- holds information from book to display -->
      <div class="searchInfo">
        <!-- book title routes to single book info page -->
        <h6>
          <a routerLink="/Book/{{ getIsbn(b) }}">{{
            b.volumeInfo.title.length > 30
              ? (b.volumeInfo.title | slice: 0:30) + "..."
              : b.volumeInfo.title
          }}</a>
        </h6>
        <p>Author(s): {{ b.volumeInfo.authors }}</p>
        <p>Categories: {{ b.volumeInfo.categories }}</p>
      </div>
      <!-- holds buttons for books from search -->
    </div>
  </div>
</div>
